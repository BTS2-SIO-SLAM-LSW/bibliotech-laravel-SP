# üí™ TP Pratique : Exercices Avanc√©s Autonomes

**3 modules d'exercices progressifs et p√©dagogiques pour ma√Ætriser les contr√¥leurs et vues**

---

## üéØ Objectifs G√©n√©raux

√Ä la fin de ces exercices, vous serez capable de :
- ‚úÖ **Impl√©menter une recherche** multi-crit√®res avec filtres
- ‚úÖ **Cr√©er des composants** Blade r√©utilisables
- ‚úÖ **Ma√Ætriser la validation** avanc√©e avec Form Requests

**‚è±Ô∏è Dur√©e recommand√©e :** 45 minutes (3 modules de 15 min)
**üéì Niveau :** Autonome (solutions disponibles s√©par√©ment)
**üìù Planning sugg√©r√© :**
- **D√©butants** : Module 1 uniquement (15 min)
- **Interm√©diaires** : Modules 1-2 (30 min)
- **Confirm√©s** : Modules 1-2-3 (45 min)

üí° **Note p√©dagogique** : Chaque module explique d'abord les **concepts th√©oriques** avant de passer √† la **pratique**.

---

## üìã Vue d'Ensemble des Modules

```
üöÄ EXERCICES PROGRESSIFS (45 min)
‚îÇ
‚îú‚îÄ‚îÄ üìä Module 1: Recherche et Filtres (15 min)
‚îÇ   ‚îú‚îÄ‚îÄ üìñ Concepts: Query Builder, Request parameters, Pagination
‚îÇ   ‚îî‚îÄ‚îÄ üõ†Ô∏è Pratique: Recherche texte + filtre cat√©gorie
‚îÇ
‚îú‚îÄ‚îÄ üé® Module 2: Composants Blade (15 min)
‚îÇ   ‚îú‚îÄ‚îÄ üìñ Concepts: Blade Components, Props, Slots
‚îÇ   ‚îî‚îÄ‚îÄ üõ†Ô∏è Pratique: Composant carte livre r√©utilisable
‚îÇ
‚îî‚îÄ‚îÄ ‚úÖ Module 3: Validation Avanc√©e (15 min)
    ‚îú‚îÄ‚îÄ üìñ Concepts: Form Requests, R√®gles custom
    ‚îî‚îÄ‚îÄ üõ†Ô∏è Pratique: Validation ISBN avec Form Request
```

---

## üìä Module 1 : Recherche et Filtres (15 min)

### **üìñ Partie 1 : Comprendre les Concepts (5 min)**

#### **ÔøΩ Concept 1 : Query Builder Dynamique**

Le **Query Builder** de Laravel permet de construire des requ√™tes SQL de mani√®re progressive :

```php
// ‚ùå MAUVAISE APPROCHE : Requ√™te fixe
$livres = Livre::all(); // R√©cup√®re TOUJOURS tous les livres

// ‚úÖ BONNE APPROCHE : Query Builder dynamique
$query = Livre::query(); // Cr√©e une requ√™te vide

if ($request->filled('search')) {
    $query->where('titre', 'LIKE', '%' . $request->search . '%');
}

$livres = $query->get(); // Ex√©cute la requ√™te construite
```

**üí° Pourquoi c'est utile ?**
- Permet d'ajouter des filtres **conditionnellement**
- √âvite la duplication de code
- Plus performant (ne charge que les donn√©es n√©cessaires)

#### **üéì Concept 2 : Request Parameters**

Les param√®tres d'URL permettent de passer des donn√©es via GET :

```php
// URL : /livres?search=Laravel&categorie=1

// Dans le contr√¥leur :
$request->filled('search')    // true si param√®tre existe ET non vide
$request->has('search')       // true si param√®tre existe (m√™me vide)
$request->get('search')       // R√©cup√®re la valeur
$request->get('sort', 'titre') // Avec valeur par d√©faut
```

#### **üéì Concept 3 : Pagination avec Filtres**

La pagination doit **conserver les param√®tres** de recherche :

```php
// ‚ùå PROBL√àME : Les filtres disparaissent au changement de page
$livres = $query->paginate(10);

// ‚úÖ SOLUTION : Utiliser appends() pour conserver les param√®tres
$livres = $query->paginate(10)->appends($request->all());

// Dans la vue, les liens de pagination incluront : ?search=Laravel&page=2
```

---

### **üõ†Ô∏è Partie 2 : Exercice Pratique (10 min)**

#### **üìù Exercice 1.1 : Recherche Simple**

**Objectif** : Permettre de chercher un livre par titre ou auteur

**√âtape 1** : Modifier la m√©thode `index` du `LivreController`

```php
public function index(Request $request)
{
    // 1. Cr√©er une requ√™te de base avec la relation categorie
    $query = Livre::with('categorie');
    
    // 2. TODO: Ajouter la recherche si le param√®tre 'search' existe
    if ($request->filled('search')) {
        $search = $request->search;
        
        // Rechercher dans titre OU auteur (insensible √† la casse)
        $query->where(function($q) use ($search) {
            $q->where('titre', 'LIKE', "%{$search}%")
              ->orWhere('auteur', 'LIKE', "%{$search}%");
        });
    }
    
    // 3. TODO: Ex√©cuter la requ√™te avec pagination (10 par page)
    $livres = $query->orderBy('titre')->paginate(10);
    
    // 4. TODO: Ajouter les param√®tres de recherche aux liens de pagination
    $livres->appends($request->all());
    
    return view('livres.index', compact('livres'));
}
```

**üí° Explication du code :**
- `where(function($q) {...})` : Groupe les conditions avec des parenth√®ses SQL
- `LIKE "%{$search}%"` : Recherche partielle (contient le texte)
- `appends($request->all())` : Conserve ?search=... dans les liens de pagination

---

#### **üìù Exercice 1.2 : Filtre par Cat√©gorie**

**Objectif** : Ajouter un filtre pour afficher uniquement les livres d'une cat√©gorie

```php
public function index(Request $request)
{
    $query = Livre::with('categorie');
    
    // Recherche (code pr√©c√©dent)
    if ($request->filled('search')) {
        // ... (code de l'exercice 1.1)
    }
    
    // TODO: Filtre par cat√©gorie
    if ($request->filled('categorie_id')) {
        $query->where('categorie_id', $request->categorie_id);
    }
    
    $livres = $query->orderBy('titre')->paginate(10)->appends($request->all());
    
    // TODO: R√©cup√©rer toutes les cat√©gories pour le formulaire
    $categories = Categorie::orderBy('nom')->get();
    
    return view('livres.index', compact('livres', 'categories'));
}
```

---

#### **üìù Exercice 1.3 : Formulaire de Recherche**

**Objectif** : Cr√©er le formulaire HTML pour la recherche et les filtres

**Cr√©er dans `resources/views/livres/index.blade.php` :**

```blade
@extends('layouts.app')

@section('content')
<div class="container mt-4">
    <h1>üìö Liste des Livres</h1>
    
    {{-- Formulaire de recherche --}}
    <div class="card mb-4">
        <div class="card-body">
            <form method="GET" action="{{ route('livres.index') }}">
                <div class="row g-3">
                    {{-- Champ de recherche --}}
                    <div class="col-md-6">
                        <label for="search" class="form-label">üîç Rechercher</label>
                        <input type="text" 
                               class="form-control" 
                               id="search" 
                               name="search" 
                               placeholder="Titre ou auteur..."
                               value="{{ request('search') }}">
                    </div>
                    
                    {{-- Filtre cat√©gorie --}}
                    <div class="col-md-4">
                        <label for="categorie_id" class="form-label">üìÇ Cat√©gorie</label>
                        <select class="form-select" id="categorie_id" name="categorie_id">
                            <option value="">Toutes les cat√©gories</option>
                            @foreach($categories as $categorie)
                                <option value="{{ $categorie->id }}" 
                                        {{ request('categorie_id') == $categorie->id ? 'selected' : '' }}>
                                    {{ $categorie->nom }}
                                </option>
                            @endforeach
                        </select>
                    </div>
                    
                    {{-- Boutons --}}
                    <div class="col-md-2 d-flex align-items-end gap-2">
                        <button type="submit" class="btn btn-primary">
                            Rechercher
                        </button>
                        <a href="{{ route('livres.index') }}" class="btn btn-secondary">
                            R√©initialiser
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>
    
    {{-- R√©sultats --}}
    <div class="card">
        <div class="card-header">
            <strong>{{ $livres->total() }}</strong> livre(s) trouv√©(s)
        </div>
        <div class="card-body">
            {{-- TODO: Afficher la liste des livres (tableau ou cartes) --}}
            @forelse($livres as $livre)
                {{-- Affichage de chaque livre --}}
            @empty
                <p class="text-muted">Aucun livre trouv√©.</p>
            @endforelse
            
            {{-- Pagination --}}
            <div class="mt-3">
                {{ $livres->links() }}
            </div>
        </div>
    </div>
</div>
@endsection
```

**ÔøΩ Points cl√©s √† comprendre :**
- `request('search')` : R√©cup√®re la valeur du param√®tre pour pr√©-remplir le formulaire
- `{{ request('categorie_id') == $categorie->id ? 'selected' : '' }}` : Maintient la s√©lection
- `{{ $livres->total() }}` : Affiche le nombre total de r√©sultats
- `{{ $livres->links() }}` : G√©n√®re les liens de pagination avec les filtres

---

### **‚úÖ V√©rification du Module 1**

**Checklist de validation :**
- [ ] La recherche fonctionne sur titre ET auteur
- [ ] Le filtre cat√©gorie fonctionne
- [ ] Les filtres persistent lors du changement de page
- [ ] Le bouton "R√©initialiser" supprime tous les filtres
- [ ] Le nombre total de r√©sultats s'affiche correctement

---

## üé® Module 2 : Composants Blade R√©utilisables (15 min)

### **üìñ Partie 1 : Comprendre les Concepts (5 min)**

#### **ÔøΩ Concept 1 : Qu'est-ce qu'un Composant Blade ?**

Un **composant Blade** est un **morceau de vue r√©utilisable** avec sa propre logique.

**Exemple concret :**
Imaginez que vous affichez des cartes de livres √† 5 endroits diff√©rents (page d'accueil, recherche, cat√©gorie, favoris, nouveaut√©s). Sans composant :

```blade
{{-- ‚ùå Code DUPLIQU√â 5 fois --}}
<div class="card">
    <div class="card-body">
        <h5>{{ $livre->titre }}</h5>
        <p>{{ $livre->auteur }}</p>
        <span class="badge bg-primary">{{ $livre->categorie->nom }}</span>
    </div>
</div>
```

Avec un composant :

```blade
{{-- ‚úÖ Code R√âUTILISABLE partout --}}
<x-livre-card :livre="$livre" />
```

**üí° Avantages :**
- **DRY** (Don't Repeat Yourself) : Pas de duplication
- **Maintenabilit√©** : Une modification = tous les endroits sont mis √† jour
- **Lisibilit√©** : Code plus clair et concis

#### **üéì Concept 2 : Props (Propri√©t√©s)**

Les **props** sont les **param√®tres** qu'on passe au composant.

```blade
{{-- Passer des donn√©es au composant --}}
<x-livre-card 
    :livre="$livre"           {{-- Variable PHP (avec :) --}}
    show-actions="true"       {{-- Valeur texte (sans :) --}}
    size="large"
/>
```

Dans le composant, on d√©clare les props accept√©es :

```php
@props([
    'livre',              // Obligatoire
    'showActions' => true, // Optionnel avec valeur par d√©faut
    'size' => 'medium'
])
```

#### **üéì Concept 3 : Structure d'un Composant**

Un composant Blade est un fichier dans `resources/views/components/` :

```
resources/views/components/
‚îú‚îÄ‚îÄ livre-card.blade.php    ‚Üí Utilis√© avec <x-livre-card />
‚îú‚îÄ‚îÄ alert.blade.php         ‚Üí Utilis√© avec <x-alert />
‚îî‚îÄ‚îÄ navigation/
    ‚îî‚îÄ‚îÄ menu.blade.php      ‚Üí Utilis√© avec <x-navigation.menu />
```

---

### **üõ†Ô∏è Partie 2 : Exercice Pratique (10 min)**

#### **üìù Exercice 2.1 : Cr√©er un Composant Carte Livre**

**Objectif** : Cr√©er un composant r√©utilisable pour afficher une carte de livre

**√âtape 1** : Cr√©er le fichier `resources/views/components/livre-card.blade.php`

```blade
{{-- 
    Composant Carte Livre
    Usage : <x-livre-card :livre="$livre" />
--}}

@props([
    'livre',                    // Le mod√®le Livre (obligatoire)
    'showActions' => true,      // Afficher les boutons d'action
    'compact' => false          // Mode compact (moins de d√©tails)
])

<div class="card h-100 shadow-sm hover-shadow">
    {{-- En-t√™te avec cat√©gorie --}}
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
        <span>üìö {{ $livre->categorie->nom ?? 'Sans cat√©gorie' }}</span>
        
        {{-- Badge disponibilit√© --}}
        @if($livre->disponible ?? true)
            <span class="badge bg-success">Disponible</span>
        @else
            <span class="badge bg-secondary">Emprunt√©</span>
        @endif
    </div>
    
    {{-- Corps de la carte --}}
    <div class="card-body">
        {{-- Titre --}}
        <h5 class="card-title">{{ $livre->titre }}</h5>
        
        {{-- Auteur --}}
        <p class="card-text text-muted mb-2">
            <strong>Auteur :</strong> {{ $livre->auteur }}
        </p>
        
        {{-- R√©sum√© (seulement si mode non compact) --}}
        @if(!$compact && isset($livre->resume))
            <p class="card-text small">
                {{ Str::limit($livre->resume, 100) }}
            </p>
        @endif
        
        {{-- ISBN (seulement si mode non compact) --}}
        @if(!$compact && isset($livre->isbn))
            <p class="card-text small text-muted">
                <strong>ISBN :</strong> {{ $livre->isbn }}
            </p>
        @endif
    </div>
    
    {{-- Actions --}}
    @if($showActions)
        <div class="card-footer bg-light d-flex gap-2">
            <a href="{{ route('livres.show', $livre) }}" 
               class="btn btn-sm btn-primary flex-fill">
                üëÅÔ∏è Voir
            </a>
            <a href="{{ route('livres.edit', $livre) }}" 
               class="btn btn-sm btn-warning flex-fill">
                ‚úèÔ∏è Modifier
            </a>
        </div>
    @endif
</div>

{{-- Styles pour l'effet hover --}}
@once
@push('styles')
<style>
    .hover-shadow {
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .hover-shadow:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.2) !important;
    }
</style>
@endpush
@endonce
```

**üí° Explication du code :**
- `@props([...])` : D√©clare les propri√©t√©s accept√©es
- `{{ $livre->categorie->nom ?? 'Sans cat√©gorie' }}` : Affiche la cat√©gorie ou valeur par d√©faut
- `@if(!$compact)` : Affiche conditionnellement selon le mode
- `Str::limit($livre->resume, 100)` : Tronque le texte √† 100 caract√®res
- `@once @push('styles')` : Ajoute le CSS une seule fois (m√™me si composant utilis√© plusieurs fois)

---

#### **üìù Exercice 2.2 : Utiliser le Composant**

**Objectif** : Remplacer le code HTML r√©p√©t√© par le composant

**Dans `resources/views/livres/index.blade.php` :**

```blade
@extends('layouts.app')

@section('content')
<div class="container mt-4">
    <h1>üìö Liste des Livres</h1>
    
    {{-- ... Formulaire de recherche (Module 1) ... --}}
    
    {{-- R√©sultats en grille de cartes --}}
    <div class="row g-3">
        @forelse($livres as $livre)
            <div class="col-md-4">
                {{-- ‚úÖ Utilisation du composant --}}
                <x-livre-card :livre="$livre" />
            </div>
        @empty
            <div class="col-12">
                <p class="text-muted text-center">Aucun livre trouv√©.</p>
            </div>
        @endforelse
    </div>
    
    {{-- Pagination --}}
    <div class="mt-4">
        {{ $livres->links() }}
    </div>
</div>
@endsection
```

**Exemples d'utilisation avec diff√©rentes options :**

```blade
{{-- Mode normal avec actions --}}
<x-livre-card :livre="$livre" />

{{-- Mode compact sans actions --}}
<x-livre-card :livre="$livre" :show-actions="false" compact />

{{-- Compact avec actions --}}
<x-livre-card :livre="$livre" :compact="true" />
```

---

#### **üìù Exercice 2.3 : Cr√©er un Composant Alert R√©utilisable**

**Objectif** : Cr√©er un composant pour les messages flash

**Cr√©er `resources/views/components/alert.blade.php` :**

```blade
@props([
    'type' => 'info',  // success, danger, warning, info
    'dismissible' => true,
    'icon' => null
])

@php
    // Mapper les types aux ic√¥nes
    $icons = [
        'success' => '‚úÖ',
        'danger' => '‚ùå',
        'warning' => '‚ö†Ô∏è',
        'info' => '‚ÑπÔ∏è'
    ];
    $displayIcon = $icon ?? $icons[$type] ?? '‚ÑπÔ∏è';
@endphp

<div class="alert alert-{{ $type }} {{ $dismissible ? 'alert-dismissible fade show' : '' }}" role="alert">
    <strong>{{ $displayIcon }}</strong> {{ $slot }}
    
    @if($dismissible)
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    @endif
</div>
```

**Utilisation dans les vues :**

```blade
{{-- Message de succ√®s --}}
<x-alert type="success">
    Le livre a √©t√© cr√©√© avec succ√®s !
</x-alert>

{{-- Message d'erreur non dismissible --}}
<x-alert type="danger" :dismissible="false">
    Une erreur est survenue.
</x-alert>

{{-- Avec messages flash --}}
@if(session('success'))
    <x-alert type="success">{{ session('success') }}</x-alert>
@endif
```

---

### **‚úÖ V√©rification du Module 2**

**Checklist de validation :**
- [ ] Le composant `livre-card` affiche correctement toutes les informations
- [ ] L'effet hover fonctionne (carte se soul√®ve au survol)
- [ ] Les boutons "Voir" et "Modifier" fonctionnent
- [ ] Le mode compact masque bien le r√©sum√© et l'ISBN
- [ ] Le composant `alert` affiche les messages avec les bonnes couleurs

**üìù Cr√©er `resources/views/components/form-field.blade.php` :**

```blade
@props([
    'name',
    'label',
    'type' => 'text',
    'value' => '',
    'options' => [],
    'required' => false,
    'help' => null
])

{{-- TODO: Composant g√©n√©rique pour : --}}
{{-- 1. Input text, number, date, email --}}
{{-- 2. Textarea --}}
{{-- 3. Select avec options --}}
{{-- 4. Checkbox --}}
{{-- 5. Gestion automatique des erreurs --}}
{{-- 6. Texte d'aide optionnel --}}
```

---

## ‚úÖ Module 3 : Validation Avanc√©e avec Form Requests (15 min)

### **üìñ Partie 1 : Comprendre les Concepts (5 min)**

#### **üéì Concept 1 : Pourquoi utiliser des Form Requests ?**

**Sans Form Request** (validation dans le contr√¥leur) :

```php
// ‚ùå PROBL√àME : Code de validation m√©lang√© avec la logique m√©tier
public function store(Request $request)
{
    $validated = $request->validate([
        'titre' => 'required|max:255',
        'auteur' => 'required|max:255',
        'isbn' => 'required|size:13|unique:livres',
        // ... 10 autres r√®gles
    ]);
    
    Livre::create($validated);
    // ... autres actions
}

// Si on veut les m√™mes r√®gles pour update() ‚Üí DUPLICATION
```

**Avec Form Request** (validation s√©par√©e) :

```php
// ‚úÖ SOLUTION : Validation isol√©e et r√©utilisable
public function store(StoreLivreRequest $request)
{
    Livre::create($request->validated());
    // Contr√¥leur plus court et lisible
}
```

**üí° Avantages :**
- **S√©paration des responsabilit√©s** : Validation ‚â† Logique m√©tier
- **R√©utilisabilit√©** : M√™me validation pour store() et update()
- **Testabilit√©** : Plus facile √† tester
- **Autorisation int√©gr√©e** : Peut inclure `authorize()`

#### **üéì Concept 2 : Structure d'une Form Request**

```php
class StoreLivreRequest extends FormRequest
{
    // 1. Autorisation : Qui peut utiliser ce formulaire ?
    public function authorize()
    {
        return true; // ou Auth::check()
    }
    
    // 2. R√®gles de validation
    public function rules()
    {
        return [
            'titre' => 'required|max:255',
        ];
    }
    
    // 3. Messages personnalis√©s (optionnel)
    public function messages()
    {
        return [
            'titre.required' => 'Le titre est obligatoire',
        ];
    }
}
```

#### **üéì Concept 3 : R√®gles de Validation Personnalis√©es**

Laravel permet de cr√©er vos propres r√®gles :

```php
// R√®gle inline (simple)
'isbn' => ['required', function ($attribute, $value, $fail) {
    if (!$this->validateIsbn($value)) {
        $fail("L'ISBN $value n'est pas valide.");
    }
}]

// R√®gle d√©di√©e (r√©utilisable)
'isbn' => ['required', new ValidIsbn]
```

---

### **üõ†Ô∏è Partie 2 : Exercice Pratique (10 min)**

#### **üìù Exercice 3.1 : Cr√©er une Form Request**

**Objectif** : D√©placer la validation du contr√¥leur vers une Form Request

**√âtape 1** : G√©n√©rer la Form Request

```bash
php artisan make:request StoreLivreRequest
```

**√âtape 2** : Impl√©menter `app/Http/Requests/StoreLivreRequest.php`

```php
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class StoreLivreRequest extends FormRequest
{
    /**
     * D√©termine si l'utilisateur est autoris√© √† faire cette requ√™te
     */
    public function authorize(): bool
    {
        // TODO: Retourner true pour autoriser tout le monde
        // Dans une vraie app, v√©rifier les permissions : Auth::user()->can('create', Livre::class)
        return true;
    }

    /**
     * R√®gles de validation
     */
    public function rules(): array
    {
        return [
            'titre' => [
                'required',
                'string',
                'max:255',
            ],
            'auteur' => [
                'required',
                'string',
                'max:255',
            ],
            'isbn' => [
                'required',
                'string',
                'size:13',        // ISBN-13 fait exactement 13 chiffres
                'unique:livres',  // Doit √™tre unique dans la table livres
                'regex:/^\d+$/',  // Uniquement des chiffres
            ],
            'resume' => [
                'nullable',
                'string',
                'max:1000',
            ],
            'date_publication' => [
                'nullable',
                'date',
                'before_or_equal:today', // Pas de date future
            ],
            'categorie_id' => [
                'required',
                'exists:categories,id', // Doit exister dans la table categories
            ],
        ];
    }

    /**
     * Messages d'erreur personnalis√©s en fran√ßais
     */
    public function messages(): array
    {
        return [
            'titre.required' => 'Le titre est obligatoire.',
            'titre.max' => 'Le titre ne peut pas d√©passer :max caract√®res.',
            
            'auteur.required' => 'L\'auteur est obligatoire.',
            'auteur.max' => 'Le nom de l\'auteur ne peut pas d√©passer :max caract√®res.',
            
            'isbn.required' => 'L\'ISBN est obligatoire.',
            'isbn.size' => 'L\'ISBN doit contenir exactement 13 chiffres.',
            'isbn.unique' => 'Cet ISBN existe d√©j√† dans la base de donn√©es.',
            'isbn.regex' => 'L\'ISBN ne doit contenir que des chiffres.',
            
            'date_publication.before_or_equal' => 'La date de publication ne peut pas √™tre dans le futur.',
            
            'categorie_id.required' => 'La cat√©gorie est obligatoire.',
            'categorie_id.exists' => 'Cette cat√©gorie n\'existe pas.',
        ];
    }

    /**
     * Noms d'attributs personnalis√©s pour les messages
     */
    public function attributes(): array
    {
        return [
            'titre' => 'titre du livre',
            'auteur' => 'nom de l\'auteur',
            'isbn' => 'ISBN',
            'categorie_id' => 'cat√©gorie',
        ];
    }
}
```

**ÔøΩ Explication du code :**
- `authorize()` : Contr√¥le d'acc√®s (true = tout le monde peut cr√©er un livre)
- `rules()` : Toutes les r√®gles de validation
- `messages()` : Messages personnalis√©s en fran√ßais
- `attributes()` : Noms d'attributs pour des messages plus clairs
- `size:13` : Longueur exacte (ISBN-13)
- `exists:categories,id` : V√©rifie que la cat√©gorie existe
- `before_or_equal:today` : Date ‚â§ aujourd'hui

---

#### **üìù Exercice 3.2 : Utiliser la Form Request dans le Contr√¥leur**

**Objectif** : Remplacer `Request` par `StoreLivreRequest`

**Modifier `app/Http/Controllers/LivreController.php` :**

```php
<?php

namespace App\Http\Controllers;

use App\Models\Livre;
use App\Models\Categorie;
use App\Http\Requests\StoreLivreRequest; // ‚Üê Importer la Form Request
use Illuminate\Http\Request;

class LivreController extends Controller
{
    // ... autres m√©thodes (index, create, show) ...
    
    /**
     * Enregistrer un nouveau livre
     */
    public function store(StoreLivreRequest $request) // ‚Üê Remplacer Request
    {
        // ‚úÖ Plus besoin de $request->validate() !
        // La validation est d√©j√† faite automatiquement par Laravel
        
        // Cr√©er le livre avec les donn√©es valid√©es
        $livre = Livre::create($request->validated());
        
        // Message flash de succ√®s
        return redirect()
            ->route('livres.show', $livre)
            ->with('success', 'Le livre "' . $livre->titre . '" a √©t√© cr√©√© avec succ√®s !');
    }
}
```

**üí° Comment √ßa fonctionne ?**

1. **Laravel intercepte** la requ√™te avant qu'elle n'arrive au contr√¥leur
2. **Ex√©cute automatiquement** `authorize()` et `rules()`
3. **Si validation √©choue** : Redirige vers le formulaire avec les erreurs
4. **Si validation r√©ussit** : Passe au contr√¥leur avec `$request->validated()`

---

#### **üìù Exercice 3.3 : Cr√©er une R√®gle de Validation Custom pour ISBN**

**Objectif** : Valider le checksum de l'ISBN-13 (algorithme de v√©rification)

**√âtape 1** : Cr√©er la r√®gle personnalis√©e

```bash
php artisan make:rule ValidIsbn
```

**√âtape 2** : Impl√©menter `app/Rules/ValidIsbn.php`

```php
<?php

namespace App\Rules;

use Closure;
use Illuminate\Contracts\Validation\ValidationRule;

class ValidIsbn implements ValidationRule
{
    /**
     * Valide un ISBN-13
     */
    public function validate(string $attribute, mixed $value, Closure $fail): void
    {
        // V√©rifier que c'est bien 13 chiffres
        if (!preg_match('/^\d{13}$/', $value)) {
            $fail("L'ISBN doit contenir exactement 13 chiffres.");
            return;
        }
        
        // Calculer le checksum ISBN-13
        $sum = 0;
        for ($i = 0; $i < 12; $i++) {
            $digit = (int) $value[$i];
            $sum += ($i % 2 === 0) ? $digit : $digit * 3;
        }
        
        $checksum = (10 - ($sum % 10)) % 10;
        $lastDigit = (int) $value[12];
        
        // V√©rifier si le dernier chiffre correspond au checksum
        if ($lastDigit !== $checksum) {
            $fail("L'ISBN $value n'est pas valide (checksum incorrect).");
        }
    }
}
```

**√âtape 3** : Utiliser la r√®gle dans la Form Request

```php
// Dans StoreLivreRequest.php
use App\Rules\ValidIsbn;

public function rules(): array
{
    return [
        // ... autres champs ...
        
        'isbn' => [
            'required',
            'string',
            'unique:livres',
            new ValidIsbn, // ‚Üê Utiliser la r√®gle personnalis√©e
        ],
    ];
}
```

**üí° Explication de l'algorithme ISBN-13 :**
- On multiplie les chiffres pairs par 1, les impairs par 3
- On additionne le tout
- Le dernier chiffre doit faire en sorte que la somme soit divisible par 10

**Exemple avec ISBN valide : 9782100547357**
```
9√ó1 + 7√ó3 + 8√ó1 + 2√ó3 + 1√ó1 + 0√ó3 + 0√ó1 + 5√ó3 + 4√ó1 + 7√ó3 + 3√ó1 + 5√ó3 = 113
Checksum = (10 - (113 % 10)) % 10 = 7 ‚úÖ
```

---

### **‚úÖ V√©rification du Module 3**

**Checklist de validation :**
- [ ] La Form Request `StoreLivreRequest` est cr√©√©e et fonctionne
- [ ] Tous les champs sont valid√©s avec les bonnes r√®gles
- [ ] Les messages d'erreur s'affichent en fran√ßais
- [ ] La r√®gle personnalis√©e `ValidIsbn` fonctionne
- [ ] Le contr√¥leur `store()` utilise `StoreLivreRequest` au lieu de `Request`
- [ ] Tester avec un ISBN invalide : l'erreur s'affiche

---

## üéØ R√©capitulatif des 3 Modules

### **üìä Ce que vous avez appris**

| Module | Concepts | Comp√©tences |
|--------|----------|-------------|
| **1. Recherche** | Query Builder, Request params, Pagination | Filtres dynamiques, URL persistantes |
| **2. Composants** | Blade Components, Props, Slots | Code r√©utilisable, DRY |
| **3. Validation** | Form Requests, R√®gles custom | Validation robuste, S√©paration logique |

### **‚úÖ Bar√®me de Notation (sur 15 points)**

| Crit√®re | Points | Description |
|---------|---------|-------------|
| **Module 1** | 5 pts | Recherche + Filtre cat√©gorie fonctionnels |
| **Module 2** | 5 pts | Composant livre-card r√©utilisable |
| **Module 3** | 5 pts | Form Request avec validation ISBN |
| **BONUS** | +2 pts | R√®gle ValidIsbn avec checksum |

### **üéØ Niveaux de Comp√©tence (sur 15)**

- **13-15 pts** : Expert - Ma√Ætrise compl√®te des concepts avanc√©s
- **10-12 pts** : Avanc√© - Bonnes pratiques respect√©es
- **7-9 pts** : Interm√©diaire - Fonctionnalit√©s de base impl√©ment√©es
- **< 7 pts** : D√©butant - R√©viser les concepts fondamentaux

---

## üìö Ressources Compl√©mentaires

### **Documentation Laravel**
- [Query Builder](https://laravel.com/docs/queries)
- [Blade Components](https://laravel.com/docs/blade#components)
- [Form Requests](https://laravel.com/docs/validation#form-request-validation)
- [Validation Rules](https://laravel.com/docs/validation#available-validation-rules)

### **Pour aller plus loin (optionnel)**
- üìñ **Module Bonus 1** : Optimisation des requ√™tes (Eager Loading, Select)
- üìñ **Module Bonus 2** : Export PDF/Excel (packages externes)
- üìñ **Module Bonus 3** : Cache Redis pour am√©liorer les performances

---

**üí° Conseil p√©dagogique** : Si vous bloquez sur un exercice, **relisez la partie th√©orique** (üìñ Comprendre les Concepts) avant de passer √† la pratique. Les concepts sont expliqu√©s avec des exemples concrets pour faciliter la compr√©hension.

**Derni√®re mise √† jour :** 6 octobre 2025

    }

    public function message()
    {
        return 'Le :attribute doit √™tre un ISBN-13 valide.';
    }
}
```

### **üèóÔ∏è Exercice 3.3 : Validation Conditionnelle**

**üìù Objectifs √† impl√©menter :**
- Si cat√©gorie = "Roman", le r√©sum√© devient obligatoire
- Si pages > 1000, ajouter un champ "tome" obligatoire
**Derni√®re mise √† jour :** 6 octobre 2025
<script>
// TODO: JavaScript pour auto-hide des toasts
</script>
@endpush
```

### **üèóÔ∏è Exercice 4.3 : Loading States et Feedback**

**üìù Objectifs :**
- Spinner de chargement lors des soumissions de formulaire
- Skeleton loading pour la liste des livres
- Feedback visuel pour les actions (boutons disabled, etc.)
- Confirmation inline pour les suppressions

---

## ‚ö° Module 5 : Performance & Export (12 min)

### **üéØ Objectif :** Optimiser les performances et ajouter des fonctionnalit√©s d'export

### **üèóÔ∏è Exercice 5.1 : Optimisation des Requ√™tes**

**üìù Am√©liorer les performances du contr√¥leur :**

```php
public function index(Request $request)
{
    // TODO: Optimisations √† impl√©menter :
    // 1. Eager loading intelligent selon les besoins
    // 2. Cache des cat√©gories (rarement modifi√©es)
    // 3. Requ√™te optimis√©e pour le comptage
    // 4. Index de base de donn√©es pour la recherche
    
    $query = Livre::query();
    
    // TODO: N'inclure 'categorie' que si n√©cessaire
    // TODO: Utiliser select() pour limiter les colonnes
    // TODO: Cache pour les compteurs globaux
    
    return view('livres.index', compact('livres', 'categories'));
}
```

### **üèóÔ∏è Exercice 5.2 : Export PDF et Excel**

## ‚ö° Module 5 : Performance & Export (30 min) üè† OPTIONNEL - BONUS MAISON

> **‚ö†Ô∏è ATTENTION** : Ce module est **OPTIONNEL** et doit √™tre fait **√† la maison** ou en dehors de la s√©ance de 3h.  
> Il n√©cessite l'installation de packages externes (PDF/Excel) et des concepts avanc√©s (Cache/Redis).  
> **Dur√©e estim√©e :** 30-40 minutes (installation incluse)

### **üéØ Objectif :** Optimiser les performances et ajouter des fonctionnalit√©s d'export avanc√©es

### **üèóÔ∏è Exercice 5.1 : Optimisation des Requ√™tes**

**üìù Objectifs :**
- Utiliser `select()` pour limiter les colonnes charg√©es
- Impl√©menter le Eager Loading pour √©viter le probl√®me N+1
- Indexer les colonnes fr√©quemment recherch√©es
- Utiliser `chunk()` pour les gros volumes

**üí° Pourquoi c'est important ?**
- R√©duction du temps de chargement de 50-80%
- Moins de consommation m√©moire
- Meilleure exp√©rience utilisateur

---

### **üèóÔ∏è Exercice 5.2 : Export PDF et Excel**

**üìù Installer les d√©pendances :**

```bash
# TODO: Installer les packages n√©cessaires
composer require barryvdh/laravel-dompdf
composer require maatwebsite/excel
```

**üìù Cr√©er les m√©thodes d'export :**

```php
// Dans LivreController
public function exportPdf(Request $request)
{
    // TODO: G√©n√©rer un PDF avec la liste filtr√©e
    // 1. R√©cup√©rer les livres selon les filtres actuels
    // 2. Cr√©er une vue sp√©ciale pour PDF
    // 3. G√©n√©rer et t√©l√©charger le PDF
}

public function exportExcel(Request $request)
{
    // TODO: G√©n√©rer un Excel avec la liste filtr√©e
    // 1. Utiliser Laravel Excel
    // 2. Formater les donn√©es correctement
    // 3. Inclure des totaux et statistiques
}
```

### **üèóÔ∏è Exercice 5.3 : Cache et M√©morisation**

**üìù Objectifs :**
- Cache Redis/File pour les cat√©gories
- M√©morisation des recherches fr√©quentes
- Cache des statistiques (nombre total de livres, etc.)
- Invalidation intelligente du cache

**üí° Ressources pour Module 5 :**
- Documentation Laravel Cache : https://laravel.com/docs/cache
- Laravel Excel : https://docs.laravel-excel.com/
- Laravel DomPDF : https://github.com/barryvdh/laravel-dompdf

---

## üéØ Challenges Bonus (Optionnels - Hors S√©ance)

### **üöÄ Challenge 1 : API REST**
Cr√©er une API REST compl√®te pour les livres avec :
- Endpoints CRUD complets
- Authentification par token
- Documentation Swagger
- Tests automatis√©s

### **üöÄ Challenge 2 : Interface Administrative**
D√©velopper un panneau d'administration avec :
- Dashboard avec statistiques
- Gestion en lot (bulk actions)
- Import CSV de livres
- Logs d'activit√©

### **üöÄ Challenge 3 : Fonctionnalit√©s Avanc√©es**
Impl√©menter des fonctionnalit√©s avanc√©es :
- Syst√®me de tags/√©tiquettes
- Favoris utilisateur
- Recommandations intelligentes
- Historique de consultation

---

## ‚úÖ Crit√®res d'√âvaluation

### **üìä Bar√®me de Notation (sur 20 points)**

**‚ö†Ô∏è Module 5 exclu du bar√®me principal (optionnel)**

| Crit√®re | Points | Description |
|---------|---------|-------------|
| **Module 1** | 5 pts | Recherche et filtres fonctionnels |
| **Module 2** | 5 pts | Composants r√©utilisables et bien structur√©s |
| **Module 3** | 5 pts | Validation robuste et messages clairs |
| **Module 4** | 5 pts | Interface responsive et UX soign√©e |
| **Module 5** | **BONUS** | Optimisations et export (si fait √† la maison) |

**üí° Note :** Le Module 5 peut rapporter des points bonus si r√©alis√© en dehors de la s√©ance.

### **üéØ Niveaux de Comp√©tence (sur 20)**

- **16-20 pts :** Expert - Ma√Ætrise compl√®te des Modules 1-4
- **12-15 pts :** Avanc√© - Bonnes pratiques respect√©es
- **8-11 pts :** Interm√©diaire - Fonctionnalit√©s de base impl√©ment√©es
- **4-7 pts :** D√©butant - Travail √† approfondir
- **0-3 pts :** Insuffisant - Revoir les concepts de base

---

## üÜò Aide et Ressources

### **üìö Documentation Utile**
- [Laravel Validation](https://laravel.com/docs/validation)
- [Blade Components](https://laravel.com/docs/blade#components)
- [Eloquent Performance](https://laravel.com/docs/eloquent#eager-loading)
- [Laravel Excel Documentation](https://docs.laravel-excel.com)

### **üí° Conseils G√©n√©raux**
1. **Testez chaque module** avant de passer au suivant
2. **Utilisez Git** pour sauvegarder vos progr√®s
3. **Commentez votre code** pour expliquer vos choix
4. **Pensez mobile** d√®s le d√©but
5. **Optimisez progressivement** (d'abord fonctionnel, puis performant)

### **üîß Outils de D√©veloppement**
- **Laravel Debugbar** pour analyser les performances
- **Browser DevTools** pour tester le responsive
- **PHPStorm/VS Code** avec extensions Laravel
- **Postman** pour tester les APIs

---

## üèÅ Validation Finale

### **üìã Checklist de Livraison**

**Module 1 - Recherche :**
- [ ] Recherche multi-crit√®res fonctionnelle
- [ ] Filtres par cat√©gorie et disponibilit√©
- [ ] Tri dynamique par colonnes
- [ ] URL avec param√®tres persistants

**Module 2 - Composants :**
- [ ] Composant livre-card r√©utilisable
- [ ] Pagination personnalis√©e
- [ ] Composants de formulaire g√©n√©riques
- [ ] Styles CSS coh√©rents

**Module 3 - Validation :**
- [ ] Form Request classes impl√©ment√©es
- [ ] R√®gles de validation personnalis√©es
- [ ] Messages d'erreur en fran√ßais
- [ ] Validation conditionnelle

**Module 4 - Mobile :**
- [ ] Navigation mobile optimis√©e
- [ ] Interface responsive
- [ ] Notifications toast
- [ ] Loading states

**Module 5 - Performance :**
- [ ] Requ√™tes optimis√©es
- [ ] Export PDF/Excel
- [ ] Cache impl√©ment√©
- [ ] Performance mesur√©e

üéâ **Bravo !** Vous ma√Ætrisez maintenant les aspects avanc√©s des contr√¥leurs et vues Laravel !